{{- $params := default site.Params.hb.header.banner .Params.header.banner }}
{{- with $params }}
  {{- $sources := slice }}
  {{- $img := "" }}
  {{- if reflect.IsSlice .img }}
    {{- range .img }}
      {{- if .media }}
        {{- $sources = $sources | append . }}
      {{- else }}
        {{- $img = .src | relURL }}
      {{- end }}
    {{- end }}
  {{- else if .img }}
    {{- $img = relURL .img }}
    {{- $res := false }}
    {{- with $.Resources.GetMatch .img }}
      {{- $res = . }}
      {{- $img = .RelPermalink }}
    {{- else }}
      {{- with resources.GetMatch .img }}
        {{- $res = . }}
        {{- $img = .RelPermalink }}
      {{- end }}
    {{- end }}
    {{- if and $res (ne $res.MediaType.SubType "svg") }}
      {{- $format := cond (eq $res.MediaType.SubType "webp") "%dx" "%dx webp" }}
      {{- $sizes := slice
        (dict "width" 1400 "minWidth" 992)
        (dict "width" 992 "minWidth" 768)
        (dict "width" 768 "minWidth" 480)
        (dict "width" 480 "minWidth" 320)
      }}
      {{- range $sizes }}
        {{- $resized := $res.Resize (printf $format .width) }}
        {{- $sources = $sources | append (dict
          "src" $resized.RelPermalink
          "media" (printf "(min-width: %dpx)" .minWidth)
          "type" $resized.MediaType)
        }}
      {{- end }}
    {{- end }}
  {{- end }}
  <style>
    .hb-header {
      height: 100vh;
    }
    {{ with .color }}
    .hb-header-banner {
      --{{ site.Params.hb.styles.prefix }}header-banner-color: {{ . }};
    }
    {{ end }}
  </style>
  {{- if $img }}
    <picture>
      {{- range $sources }}
        <source
          srcset="{{ .src }}"
          media="{{ .media }}"
          {{ with .type }}type="{{ . }}"{{ end }}/>
      {{- end }}
      <img
        class="img-fluid hb-header-banner-img d-block w-100 position-absolute top-0"
        onload="document.querySelector('.hb-header').classList.add('hb-header-banner')"
        alt="{{ $.Title }}"
        src="{{ $img }}" />
    </picture>
  {{- end }}
  {{- with .video }}
  <video
    class="hb-header-banner-video position-absolute top-0 w-100"
    onloadstart="document.querySelector('.hb-header').classList.add('hb-header-banner')"
    {{ if default true .muted }}muted{{ end }}
    loop
    autoplay>
    <source src="{{ .src }}">
  </video>
  {{- end }}
  {{- $innerClasses := slice "hb-header-banner-inner" }}
  {{- $alignment := "start" }}
  {{- with .alignment }}
    {{- $alignment = . }}
  {{- end }}
  {{- $innerClasses = $innerClasses | append (printf "text-%s" $alignment) }}
  {{- with .cols }}
    {{- range split . " " }}
      {{- $v := split . ":" }}
      {{- if lt (len $v) 2 }}
        {{- $innerClasses = $innerClasses | append (printf "col-%s" (index $v 0)) }}
      {{- else }}
        {{- $innerClasses = $innerClasses | append (printf "col-%s-%s" (index $v 0) (index $v 1)) }}
      {{- end }}
    {{- end }}
  {{- else }}
    {{- $innerClasses = $innerClasses | append "col-12" "col-lg-8" }}
  {{- end }}
  <div
    class="hb-header-banner col d-flex flex-column justify-content-center z-1 position-absolute top-0 w-100">
    <div class="container">
      <div class="row justify-content-{{ $alignment }}">
        <div class="{{ delimit $innerClasses ` ` }}">
          <h1 class="display-1">{{ default $.Title .title | markdownify }}</h1>
          <div class="lead">{{ default $.Description .description | markdownify }}</div>
        </div>
      </div>
    </div>
  </div>
{{- end }}
